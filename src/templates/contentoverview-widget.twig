{% do view.registerAssetBundle("wsydney76\\contentoverview\\assets\\ContentOverviewAssetBundle") %}

{% set transforms = {
    list: {width: 50, height: 50},
    cards: {width: 400, height: 200},
    cardlets: {width: 150, height: 150},
} %}

<div class="contentoverview">

    {% set settings =  craft.contentoverview.settings %}
    {% set site = craft.app.request.queryParam('site', craft.app.sites.primarySite.handle) %}

    {% for column in settings.layout.columns %}

        <div class="column-{{ column.width }}">
            {% for sectionSettings in column.sections %}

                {% set section = craft.app.sections.sectionByHandle(sectionSettings.handle) %}
                {% set layout = sectionSettings['layout'] ?? 'list' %}
                {% set transform = transforms[layout] %}

                {% if currentUser.can("saveentries:#{section.uid}") %}
                    <div class="section {{ layout }}">

                        {% set entries = craft.contentoverview.getEntries(section.handle, sectionSettings) %}


                        <div class="btns">
                            <h2>{{ section.name|t('site') }}</h2>
                            <a class="btn submit" href="{{ cpUrl("entries/#{section.handle}/new") }}">
                                {{ "New entry"|t('contentoverview') }}
                            </a>
                        </div>

                        {% if sectionSettings.image is defined %}
                            {% set entries = entries.with([
                                [sectionSettings.image, {withTransforms: [transform]}]
                            ]) %}
                        {% endif %}


                        {% include 'contentoverview/partials/entrieslist.twig' %}

                        <div class="btns">
                            <a class="btn" href="{{ cpUrl("entries/#{section.handle}") }}">
                                {{ "All entries"|t('contentoverview') }}
                            </a>
                        </div>

                    </div>
                {% endif %}


            {% endfor %}
        </div>
    {% endfor %}
</div>